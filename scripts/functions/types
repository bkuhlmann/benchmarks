#! /usr/bin/env ruby
# frozen_string_literal: true

require "bundler/inline"

gemfile true do
  source "https://rubygems.org"

  gem "benchmark-ips"
end

ProcFunction = proc { |message = "message"| message }
LambdaFunction = -> message = "benchmark" { message }

module ModuleFunction
  module_function

  def call(message = "benchmark") = message
end

class ClassFunction
  def initialize message = "benchmark"
    @message = message
  end

  def call = message

  private

  attr_reader :message
end

memoized_function = ClassFunction.new

Benchmark.ips do |benchmark|
  benchmark.config time: 5, warmup: 2

  benchmark.report("Proc") { ProcFunction.call }
  benchmark.report("Lambda") { LambdaFunction.call }
  benchmark.report("Module") { ModuleFunction.call }
  benchmark.report("Class (new)") { ClassFunction.new.call }
  benchmark.report("Class (memoized)") { memoized_function.call }

  benchmark.compare!
end

__END__

ruby 4.0.0 (2025-12-25 revision 553f1675f3) +YJIT +PRISM [arm64-darwin25.2.0]
Warming up --------------------------------------
                Proc     2.215M i/100ms
              Lambda     2.228M i/100ms
              Module     4.451M i/100ms
         Class (new)     2.504M i/100ms
    Class (memoized)     4.430M i/100ms
Calculating -------------------------------------
                Proc     24.163M (± 1.4%) i/s   (41.38 ns/i) -    121.842M in   5.043510s
              Lambda     24.785M (± 1.2%) i/s   (40.35 ns/i) -    124.746M in   5.033908s
              Module     59.937M (± 0.9%) i/s   (16.68 ns/i) -    302.661M in   5.050088s
         Class (new)     28.137M (± 2.4%) i/s   (35.54 ns/i) -    142.739M in   5.075867s
    Class (memoized)     55.985M (± 0.9%) i/s   (17.86 ns/i) -    283.501M in   5.064328s

Comparison:
              Module: 59937028.6 i/s
    Class (memoized): 55984529.3 i/s - 1.07x  slower
         Class (new): 28137026.3 i/s - 2.13x  slower
              Lambda: 24785195.0 i/s - 2.42x  slower
                Proc: 24163375.2 i/s - 2.48x  slower
