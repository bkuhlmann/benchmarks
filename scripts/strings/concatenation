#! /usr/bin/env ruby
# frozen_string_literal: true

require "bundler/inline"

gemfile true do
  source "https://rubygems.org"

  gem "benchmark-ips"
end

one = "One"
two = "Two"
three = "Three"
four = "Four"
five = "Five"
six = "Six"
seven = "Seven"
eight = "Eight"
nine = "Nine"
ten = "Ten"

Benchmark.ips do |benchmark|
  benchmark.config time: 5, warmup: 2

  benchmark.report "Implicit (<)" do
    "One" "Two"
  end

  benchmark.report "Implicit (>)" do
    "One" "Two" "Three" "Four" "Five" "Six" "Seven" "Eight" "Nine" "Ten"
  end

  benchmark.report "Interpolation (<)" do
    "#{one} #{two}"
  end

  benchmark.report "Interpolation (>)" do
    "#{one} #{two} #{three} #{four} #{five} #{six} #{seven} #{eight} #{nine} #{ten}"
  end

  benchmark.report "#+ (<)" do
    one + " " + two
  end

  benchmark.report "#+ (>)" do
    one + " " + two + " " + three + " " + four + " " + five + " " + six + " " + seven + " " +
    eight + " " + nine + " " + ten
  end

  # Mutation.
  benchmark.report "#concat (<)" do
    one.dup.concat two
  end

  # Mutation.
  benchmark.report "#concat (>)" do
    one.dup.concat two, three, four, five, six, seven, eight, nine, ten
  end

  # Mutation.
  benchmark.report "#<< (<)" do
    one.dup << two
  end

  # Mutation.
  benchmark.report "#<< (>)" do
    one.dup << two << three << four << five << six << seven << eight << nine << ten
  end

  benchmark.report "Array#join (<)" do
    [one, two].join " "
  end

  benchmark.report "Array#join (>)" do
    [one, two, three, four, five, six, seven, eight, nine, ten].join " "
  end

  benchmark.compare!
end

__END__

ruby 4.0.0 (2025-12-25 revision 553f1675f3) +YJIT +PRISM [arm64-darwin25.2.0]
Warming up --------------------------------------
        Implicit (<)     4.612M i/100ms
        Implicit (>)     5.156M i/100ms
   Interpolation (<)     1.681M i/100ms
   Interpolation (>)   472.381k i/100ms
              #+ (<)     1.279M i/100ms
              #+ (>)   161.656k i/100ms
         #concat (<)   524.718k i/100ms
         #concat (>)   228.594k i/100ms
             #<< (<)   576.251k i/100ms
             #<< (>)   302.123k i/100ms
      Array#join (<)     1.129M i/100ms
      Array#join (>)   397.504k i/100ms
Calculating -------------------------------------
        Implicit (<)     71.067M (± 0.1%) i/s   (14.07 ns/i) -    359.707M in   5.061526s
        Implicit (>)     71.055M (± 0.2%) i/s   (14.07 ns/i) -    355.735M in   5.006479s
   Interpolation (<)     18.556M (± 4.3%) i/s   (53.89 ns/i) -     94.139M in   5.083215s
   Interpolation (>)      5.022M (± 2.0%) i/s  (199.11 ns/i) -     25.509M in   5.080934s
              #+ (<)     13.447M (± 2.3%) i/s   (74.37 ns/i) -     67.761M in   5.041852s
              #+ (>)      1.615M (± 1.0%) i/s  (619.16 ns/i) -      8.083M in   5.005058s
         #concat (<)      5.668M (± 7.9%) i/s  (176.44 ns/i) -     28.335M in   5.027373s
         #concat (>)      2.535M (± 7.1%) i/s  (394.52 ns/i) -     12.801M in   5.072887s
             #<< (<)      6.124M (± 5.1%) i/s  (163.30 ns/i) -     31.118M in   5.093028s
             #<< (>)      3.316M (±11.8%) i/s  (301.60 ns/i) -     16.617M in   5.081439s
      Array#join (<)     11.789M (± 3.1%) i/s   (84.82 ns/i) -     59.820M in   5.078832s
      Array#join (>)      4.197M (± 1.6%) i/s  (238.26 ns/i) -     21.068M in   5.020997s

Comparison:
        Implicit (<): 71067132.6 i/s
        Implicit (>): 71055061.6 i/s - same-ish: difference falls within error
   Interpolation (<): 18555791.4 i/s - 3.83x  slower
              #+ (<): 13447051.5 i/s - 5.28x  slower
      Array#join (<): 11789148.3 i/s - 6.03x  slower
             #<< (<):  6123868.9 i/s - 11.60x  slower
         #concat (<):  5667784.5 i/s - 12.54x  slower
   Interpolation (>):  5022411.6 i/s - 14.15x  slower
      Array#join (>):  4197045.1 i/s - 16.93x  slower
             #<< (>):  3315687.6 i/s - 21.43x  slower
         #concat (>):  2534713.1 i/s - 28.04x  slower
              #+ (>):  1615100.5 i/s - 44.00x  slower
