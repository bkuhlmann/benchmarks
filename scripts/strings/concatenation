#! /usr/bin/env ruby
# frozen_string_literal: true

require "bundler/inline"

gemfile true do
  source "https://rubygems.org"

  gem "benchmark-ips"
end

one = "One"
two = "Two"
three = "Three"
four = "Four"
five = "Five"
six = "Six"
seven = "Seven"
eight = "Eight"
nine = "Nine"
ten = "Ten"

Benchmark.ips do |benchmark|
  benchmark.config time: 5, warmup: 2

  benchmark.report "Implicit (<)" do
    "One" "Two"
  end

  benchmark.report "Implicit (>)" do
    "One" "Two" "Three" "Four" "Five" "Six" "Seven" "Eight" "Nine" "Ten"
  end

  benchmark.report "Interpolation (<)" do
    "#{one} #{two}"
  end

  benchmark.report "Interpolation (>)" do
    "#{one} #{two} #{three} #{four} #{five} #{six} #{seven} #{eight} #{nine} #{ten}"
  end

  benchmark.report "#+ (<)" do
    one + " " + two
  end

  benchmark.report "#+ (>)" do
    one + " " + two + " " + three + " " + four + " " + five + " " + six + " " + seven + " " +
    eight + " " + nine + " " + ten
  end

  # WARNING: Mutation.
  benchmark.report "#concat (<)" do
    one.dup.concat two
  end

  # WARNING: Mutation.
  benchmark.report "#concat (>)" do
    one.dup.concat two, three, four, five, six, seven, eight, nine, ten
  end

  # WARNING: Mutation.
  benchmark.report "#<< (<)" do
    one.dup << two
  end

  # WARNING: Mutation.
  benchmark.report "#<< (>)" do
    one.dup << two << three << four << five << six << seven << eight << nine << ten
  end

  benchmark.report "Array#join (<)" do
    [one, two].join " "
  end

  benchmark.report "Array#join (>)" do
    [one, two, three, four, five, six, seven, eight, nine, ten].join " "
  end

  benchmark.compare!
end

__END__

ruby 3.3.0 (2023-12-25 revision 5124f9ac75) +YJIT [arm64-darwin22.6.0]
Warming up --------------------------------------
        Implicit (<)     2.601M i/100ms
        Implicit (>)     2.640M i/100ms
   Interpolation (<)   898.911k i/100ms
   Interpolation (>)   303.153k i/100ms
              #+ (<)   640.087k i/100ms
              #+ (>)    73.694k i/100ms
         #concat (<)     1.003M i/100ms
         #concat (>)   241.868k i/100ms
             #<< (<)     1.076M i/100ms
             #<< (>)   374.733k i/100ms
      Array#join (<)   557.003k i/100ms
      Array#join (>)   262.493k i/100ms
Calculating -------------------------------------
        Implicit (<)     54.132M (± 2.5%) i/s -    273.116M in   5.048673s
        Implicit (>)     54.714M (± 0.3%) i/s -    274.602M in   5.018882s
   Interpolation (<)     11.071M (± 5.6%) i/s -     55.732M in   5.047673s
   Interpolation (>)      3.267M (± 7.4%) i/s -     16.370M in   5.037346s
              #+ (<)      7.464M (± 7.0%) i/s -     37.765M in   5.086482s
              #+ (>)    742.417k (± 1.1%) i/s -      3.758M in   5.063044s
         #concat (<)     12.788M (± 0.9%) i/s -     64.219M in   5.022186s
         #concat (>)      2.551M (± 7.9%) i/s -     12.819M in   5.056076s
             #<< (<)     13.776M (± 3.9%) i/s -     68.860M in   5.006536s
             #<< (>)      4.105M (± 7.6%) i/s -     20.610M in   5.050318s
      Array#join (<)      6.393M (± 4.5%) i/s -     32.306M in   5.064649s
      Array#join (>)      2.790M (± 9.0%) i/s -     13.912M in   5.025822s

Comparison:
        Implicit (>): 54714264.9 i/s
        Implicit (<): 54131866.0 i/s - same-ish: difference falls within error
             #<< (<): 13775992.5 i/s - 3.97x  slower
         #concat (<): 12788273.5 i/s - 4.28x  slower
   Interpolation (<): 11071433.5 i/s - 4.94x  slower
              #+ (<):  7464136.7 i/s - 7.33x  slower
      Array#join (<):  6392876.9 i/s - 8.56x  slower
             #<< (>):  4105202.5 i/s - 13.33x  slower
   Interpolation (>):  3267084.5 i/s - 16.75x  slower
      Array#join (>):  2790078.5 i/s - 19.61x  slower
         #concat (>):  2551103.4 i/s - 21.45x  slower
              #+ (>):   742417.5 i/s - 73.70x  slower
