#! /usr/bin/env ruby
# frozen_string_literal: true

require "bundler/inline"

gemfile true do
  source "https://rubygems.org"

  gem "benchmark-ips"
end

example = "example"

Benchmark.ips do |benchmark|
  benchmark.config time: 5, warmup: 2

  benchmark.report("#sub (string)") { example.sub "x", "b" }
  benchmark.report("#sub (regex)") { example.sub(/x/, "b") }
  benchmark.report("#gsub (string)") { example.gsub "x", "b" }
  benchmark.report("#gsub (regex)") { example.gsub(/x/, "b") }
  benchmark.report("#tr") { example.tr "x", "b" }

  benchmark.compare!
end

__END__

ruby 3.3.0 (2023-12-25 revision 5124f9ac75) +YJIT [arm64-darwin22.6.0]
Warming up --------------------------------------
       #sub (string)   439.628k i/100ms
        #sub (regex)   307.022k i/100ms
      #gsub (string)   362.211k i/100ms
       #gsub (regex)   155.869k i/100ms
                 #tr   747.200k i/100ms
Calculating -------------------------------------
       #sub (string)      4.667M (± 4.8%) i/s -     23.740M in   5.096768s
        #sub (regex)      3.324M (± 8.4%) i/s -     16.579M in   5.022002s
      #gsub (string)      4.024M (± 8.7%) i/s -     20.284M in   5.078637s
       #gsub (regex)      1.593M (± 2.5%) i/s -      8.105M in   5.089611s
                 #tr      8.839M (± 9.2%) i/s -     44.085M in   5.025958s

Comparison:
                 #tr:  8838997.2 i/s
       #sub (string):  4667446.9 i/s - 1.89x  slower
      #gsub (string):  4023935.7 i/s - 2.20x  slower
        #sub (regex):  3323612.6 i/s - 2.66x  slower
       #gsub (regex):  1593427.3 i/s - 5.55x  slower
