#! /usr/bin/env ruby
# frozen_string_literal: true

require "bundler/inline"

gemfile true do
  source "https://rubygems.org"

  gem "benchmark-ips"
  gem "dry-struct"
end

require "ostruct"

StructExample = Struct.new :to, :from

module Types
  include Dry.Types
end

DryExample = Class.new Dry::Struct do
  attribute :to, Types::Strict::String
  attribute :from, Types::Strict::String
end

Benchmark.ips do |benchmark|
  benchmark.config time: 5, warmup: 2

  benchmark.report "Struct" do
    StructExample[to: "Rick", from: "Morty"]
  end

  benchmark.report "OpenStruct" do
    OpenStruct.new to: "Rick", from: "Morty"
  end

  benchmark.report "Dry Struct" do
    DryExample[to: "Rick", from: "Morty"]
  end

  benchmark.compare!
end

__END__

Warming up --------------------------------------
              Struct   365.528k i/100ms
          OpenStruct     2.795k i/100ms
          Dry Struct   140.753k i/100ms
Calculating -------------------------------------
              Struct      4.323M (± 3.0%) i/s -     21.932M in   5.077534s
          OpenStruct     10.600k (±24.2%) i/s -     53.105k in   5.290253s
          Dry Struct      1.475M (± 3.3%) i/s -      7.460M in   5.062260s

Comparison:
              Struct:  4322945.3 i/s
          Dry Struct:  1475101.5 i/s - 2.93x  slower
          OpenStruct:    10599.9 i/s - 407.83x  slower
