#! /usr/bin/env ruby
# frozen_string_literal: true

require "bundler/inline"

gemfile true do
  source "https://rubygems.org"

  gem "benchmark-ips"
end

example = {a: 1, b: 2, c: 3}

Benchmark.ips do |benchmark|
  benchmark.config time: 5, warmup: 2

  benchmark.report("#[]") { example[:b] }
  benchmark.report("#fetch") { example.fetch :b }
  benchmark.report("#fetch (default)") { example.fetch :b, "default" }
  benchmark.report("#fetch (block)") { example.fetch(:b) { "default" } }
  benchmark.report("#dig") { example.dig :b }

  benchmark.compare!
end

__END__

ruby 4.0.0 (2025-12-25 revision 553f1675f3) +YJIT +PRISM [arm64-darwin25.2.0]
Warming up --------------------------------------
                 #[]     4.091M i/100ms
              #fetch     3.558M i/100ms
    #fetch (default)     3.537M i/100ms
      #fetch (block)     3.528M i/100ms
                #dig     3.896M i/100ms
Calculating -------------------------------------
                 #[]     51.599M (± 0.4%) i/s   (19.38 ns/i) -    261.851M in   5.074852s
              #fetch     42.667M (± 0.4%) i/s   (23.44 ns/i) -    213.486M in   5.003628s
    #fetch (default)     42.271M (± 0.6%) i/s   (23.66 ns/i) -    212.206M in   5.020335s
      #fetch (block)     42.642M (± 0.3%) i/s   (23.45 ns/i) -    215.197M in   5.046671s
                #dig     48.266M (± 0.6%) i/s   (20.72 ns/i) -    241.570M in   5.005108s

Comparison:
                 #[]: 51598749.0 i/s
                #dig: 48266387.2 i/s - 1.07x  slower
              #fetch: 42666996.7 i/s - 1.21x  slower
      #fetch (block): 42641658.5 i/s - 1.21x  slower
    #fetch (default): 42270877.3 i/s - 1.22x  slower
