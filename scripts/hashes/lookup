#! /usr/bin/env ruby
# frozen_string_literal: true

require "bundler/inline"

gemfile true do
  source "https://rubygems.org"

  gem "benchmark-ips"
end

example = {a: 1, b: 2, c: 3}

Benchmark.ips do |benchmark|
  benchmark.config time: 5, warmup: 2

  benchmark.report("#[]") { example[:b] }
  benchmark.report("#fetch") { example.fetch :b }
  benchmark.report("#fetch (default)") { example.fetch :b, "default" }
  benchmark.report("#fetch (block)") { example.fetch(:b) { "default" } }
  benchmark.report("#dig") { example.dig :b }

  benchmark.compare!
end

__END__

ruby 3.3.0 (2023-12-25 revision 5124f9ac75) +YJIT [arm64-darwin22.6.0]
Warming up --------------------------------------
                 #[]     1.648M i/100ms
              #fetch     1.547M i/100ms
    #fetch (default)     1.562M i/100ms
      #fetch (block)     1.547M i/100ms
                #dig     1.553M i/100ms
Calculating -------------------------------------
                 #[]     26.018M (± 3.4%) i/s -    130.197M in   5.009925s
              #fetch     23.729M (± 2.5%) i/s -    119.086M in   5.021739s
    #fetch (default)     23.330M (± 3.4%) i/s -    117.134M in   5.026454s
      #fetch (block)     23.443M (± 2.8%) i/s -    117.567M in   5.018956s
                #dig     24.126M (± 1.2%) i/s -    121.144M in   5.021949s

Comparison:
                 #[]: 26018263.6 i/s
                #dig: 24126491.2 i/s - 1.08x  slower
              #fetch: 23729385.7 i/s - 1.10x  slower
      #fetch (block): 23443014.5 i/s - 1.11x  slower
    #fetch (default): 23329743.0 i/s - 1.12x  slower
