#! /usr/bin/env ruby
# frozen_string_literal: true

require "bundler/inline"

gemfile true do
  source "https://rubygems.org"

  gem "benchmark-ips"
end

a = %w[one two three]
b = %w[four five six]

Benchmark.ips do |benchmark|
  benchmark.config time: 5, warmup: 2

  benchmark.report "#+" do
    a + b
  end

  benchmark.report "#+=" do
    duplicate = a.dup
    duplicate += b
  end

  benchmark.report "#concat" do
    a.dup.concat b
  end

  benchmark.report "#|" do
    a | b
  end

  benchmark.report "#<< + #flatten" do
    (a.dup << b).flatten
  end

  benchmark.report "splat + #flatten" do
    [a, *b].flatten
  end

  benchmark.report "multi-splat" do
    [*a, *b]
  end

  benchmark.compare!
end

__END__

ruby 3.3.0 (2023-12-25 revision 5124f9ac75) +YJIT [arm64-darwin22.6.0]
Warming up --------------------------------------
                  #+   845.131k i/100ms
                 #+=   521.126k i/100ms
             #concat   452.571k i/100ms
                  #|   341.623k i/100ms
      #<< + #flatten   149.466k i/100ms
    splat + #flatten   149.001k i/100ms
         multi-splat   434.644k i/100ms
Calculating -------------------------------------
                  #+     10.475M (± 9.5%) i/s -     52.398M in   5.050961s
                 #+=      5.929M (± 7.8%) i/s -     29.704M in   5.037287s
             #concat      5.003M (± 9.8%) i/s -     24.891M in   5.023014s
                  #|      3.695M (± 8.7%) i/s -     18.448M in   5.032592s
      #<< + #flatten      1.519M (± 8.9%) i/s -      7.623M in   5.058189s
    splat + #flatten      1.531M (± 9.0%) i/s -      7.599M in   5.004145s
         multi-splat      4.701M (± 6.3%) i/s -     23.471M in   5.011116s

Comparison:
                  #+: 10474576.2 i/s
                 #+=:  5929151.0 i/s - 1.77x  slower
             #concat:  5002661.4 i/s - 2.09x  slower
         multi-splat:  4700795.0 i/s - 2.23x  slower
                  #|:  3694672.1 i/s - 2.84x  slower
    splat + #flatten:  1530591.1 i/s - 6.84x  slower
      #<< + #flatten:  1518887.3 i/s - 6.90x  slower
